<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <div id="app">
        <h1>路由的所有重要知识点</h1>
        <ul>
            <li>
                <h3>动态路由匹配</h3>
            </li>

            <li>
                <h3>嵌套路由</h3>
            </li>

            <li>
                <h3>编程式导航 route.push({path:'/home'}) </h3>
            </li>

            <li>
                <h3>命名路由</h3>
            </li>

            <li>
                <h3>命名视图 router-view name=aaa </h3>
            </li>

            <li>
                <h3>重定向和别名(redirect,alias)</h3>
            </li>

            <li>
                <h3>路由组件传参（props:true,params,query）</h3>
            </li>

            <li>
                <h3>hirstory模式(mode:hirstore)</h3>
            </li>


            <li>
                <h3>导航守卫</h3>
                <p>全局守卫 beforeEach（to,from,next）</p>
                <p>三个组件内的守卫：beforeRouteEnter (to, from, next) {} ，beforeRouteUpdate，beforeRouteLeave 他们参数都一样，除第一个函数还不能访问this
                </p>
                <p>路由单独守卫: beforeEnter（to,from,next）</p>
            </li>
            <li>
                <h3>滚动行为 scrollBehavior （）=>{ return {x:0,y:0} }</h3>
            </li>

            <li>
                <h3>路由懒加载</h3>
                <p>
                    const Foo = () => import('./Foo.vue')
                </p>
            </li>
        </ul>

        <div style="position: absolute;top: 50px;right: 400px;">
            <h1 style="margin-top: 40px;">实例</h1>
            <router-link to="/home/tm">home</router-link>
            <router-link to="/about/111">about</router-link>
            <router-view></router-view>
            <router-view name="a"></router-view>
            <!--命名路由-->
            <button @click="goaa()">aaa</button>
        </div>
    </div>

    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
    <script>
        let another1 = {
            template: `<div>ooooooooooooo</div>`
        }

        let home = { //嵌套路由
            template: `
            <div>
                <h1>Home{{$route.params.id}}</h1>
                <h1>
                    <span>{{id}}</span>
                </h1>
                <router-link to="/about/a">aaa</router-link>
                <router-link to="/about/b">bbb</router-link>
                <router-view></router-view>                
            </div>
            
        `,
            computed: {
                id() {
                    return this.$route.params.id
                }
            },
        }
        let about = {
            template: `
            <h1>hello{{$route.params.id}}</h1>
        `,
            beforeRouteUpdate(to, from) {
                console.log(to, from)
            }
        }
        let aa = {
            template: `<h1>aaaaaaaa</h1>`
        }

        let bb = {
            template: `<h1>bbbbbbbbbbbbb</h1>`
        }


        let routes = [{
                path: '/home/:id',
                components: {
                    default: home,
                    a: another1
                },
                props: {
                    name: 'id'
                }, //通过props解耦参数传递
                beforeEnter(to, from, next) { //单独定义该路径的导航守卫
                    //当前不可访问this，因为该组件实例未被创建
                    console.log(to)
                    console.log(from)
                    console.log(next)
                    next()
                    // next(false)  //传入false取消进入当前页面
                },
                scrollBehavior(to, from, savedPosition) {
                    return {
                        x: 0,
                        y: 0
                    } //滚动到页面顶部
                }

            }, {
                path: '/about/:id',
                component: about,
                children: [{
                        path: '/about/a',
                        component: aa
                    },
                    {
                        path: '/about/b',
                        component: bb
                    },
                ]
            },
            {
                path: '*', //所有无效的页面重定向 通过这个可以做404页面
                redirect: '/about/a'
            }
        ]
        const router = new VueRouter({
            routes
        })

        //全局前置守卫
        /*
            to:要去的目标对象，
            from，当前离开的对象，
            next:一定要调用该方法，进入下一个页面（或者传入你要进入的某个页面的参数）
        */
        router.beforeEach((to, from, next) => {
            console.log(to)
            console.log(from)
            console.log(next)
            next();
        })
        new Vue({
            el: '#app',
            data() {
                return {

                }
            },
            watch: {
                '$route' (to, form, next) { //监听router跳转
                    console.log(to, form, next)
                }
            },
            methods: {
                goaa() {
                    this.$router.push({ //通过函数跳转路由
                        path: '/home/a'
                    })
                }
            },
            router
        })
    </script>
</body>

</html>